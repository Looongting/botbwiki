# AI功能使用说明

## 概述

本机器人集成了多种AI服务，包括LongCat AI和火山引擎AI，提供智能对话和消息总结功能。默认使用LongCat AI服务，支持自动切换备用服务。

## 功能列表

### 1. AI连接测试
**命令**: `?ai_test`

**功能**: 测试AI服务连接是否正常

**示例**:
```
?ai_test
```

**回复示例**:
```
🤖 正在测试AI连接...
✅ AI测试成功！

AI回复：我是一个AI助手，可以帮助您解答问题和提供信息。
```

### 2. AI对话
**触发方式**: 在群内发送以 `?ai ` 开头的消息

**功能**: 与AI进行智能对话，支持各种问题咨询

**示例**:
```
?ai 今天天气怎么样？
?ai 请推荐一本好书
?ai 1+1等于几？
?ai 帮我写一首关于春天的诗
?ai 解释一下什么是人工智能
```

**回复示例**:
```
🤖 AI正在思考...
🤖 AI回复：
今天天气很好，阳光明媚，适合外出活动。建议您可以出门散步或进行户外运动。
```

### 3. AI服务状态查询
**命令**: `?ai_status`

**功能**: 查询当前AI服务配置和状态

**示例**:
```
?ai_status
```

**回复示例**:
```
🤖 AI服务状态

触发词：?ai
默认服务：longcat
可用服务：longcat, volc

使用方法：?ai <你的问题>
```

### 4. 群消息总结（开发中）
**命令**: `?ai_summary [日期]`

**功能**: 总结指定群在过去一段时间内的消息主题

**参数说明**:
- `[日期]`: 可选，指定要总结的日期（YYYY-MM-DD格式），不指定则总结昨天

**示例**:
```
?ai_summary
?ai_summary 2024-01-15
```

**回复示例**:
```
📊 正在分析群 123456789 过去 24 小时的消息...
📋 群 123456789 消息总结（过去24小时）：

主要讨论主题：
1. 游戏攻略分享
2. 日常聊天
3. 技术问题讨论
4. 活动通知

活跃用户：张三、李四、王五
```

## 配置要求

### 1. AI服务账号
根据需要申请以下AI服务账号：

#### LongCat AI（推荐，默认）
- 访问 LongCat AI 平台申请API密钥：https://longcat.chat/platform
- 使用美团App扫码登录
- 成本较低，响应速度快，由美团研发

#### 火山引擎AI（备用）
- 注册火山引擎账号
- 开通AI服务
- 获取API密钥

### 2. 环境变量配置
在`.env`文件中添加以下配置：

```bash
# AI功能配置
AI_TRIGGER_PREFIX=?ai                # AI触发词，可自定义
DEFAULT_AI_SERVICE=longcat           # 默认AI服务：longcat 或 volc
AI_SUMMARY_MAX_TOKENS=2000
AI_SUMMARY_TIMEOUT=30

# LongCat AI配置（推荐）
LONGCAT_API_KEY=your_api_key_here
LONGCAT_API_URL=https://api.longcat.chat/openai
LONGCAT_MODEL=LongCat-Flash-Chat

# 火山引擎AI配置（备用）
ARK_API_KEY=your_api_key_here
VOLC_AI_REGION=cn-beijing
VOLC_AI_ENDPOINT=ep-20250811175605-fxzbh
```

### 3. 依赖安装
```bash
pip install -r requirements.txt
```

## 测试方法

### 1. 使用测试脚本
```bash
cd /home/ubuntu/botbwiki
python test_ai.py
```

### 2. 在群内测试
1. 确保机器人已启动
2. 在群内发送 `?ai_test` 测试连接
3. 发送 `?ai 你好` 测试对话功能
4. 发送 `?ai_status` 查看服务状态

## 故障排查

### 1. AI连接失败
**可能原因**:
- API密钥配置错误
- 网络连接问题
- 火山引擎服务异常

**解决方法**:
1. 检查`.env`文件中的密钥配置
2. 运行测试脚本验证连接
3. 查看机器人日志

### 2. AI回复超时
**可能原因**:
- 网络延迟
- AI服务负载高
- 请求内容过长

**解决方法**:
1. 增加超时时间配置
2. 简化问题内容
3. 稍后重试

### 3. 权限问题
**可能原因**:
- 机器人没有群消息读取权限
- API密钥权限不足

**解决方法**:
1. 检查机器人权限设置
2. 确认API密钥权限

## 注意事项

1. **API费用**: 火山引擎AI服务按调用次数收费，请注意使用量
2. **响应时间**: AI回复可能需要几秒钟，请耐心等待
3. **内容限制**: 某些敏感内容可能被AI服务拒绝处理
4. **隐私保护**: 群消息总结功能会读取群聊记录，请注意隐私保护

## 更新日志

- **v1.0.0**: 初始版本，支持基础AI对话和连接测试
- **v1.1.0**: 添加群消息总结功能（开发中）
